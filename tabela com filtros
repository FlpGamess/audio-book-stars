import React, { useState } from "react";
import { DataTable } from "primereact/datatable";
import { Column } from "primereact/column";
import { MultiSelect } from "primereact/multiselect";
import { Button } from "primereact/button";

const TabelaComidas = () => {
  const dados = [
    {
      comida: "Pizza",
      preco: 35,
      acompanhamento: "Refrigerante",
      tipo: "Massa",
    },
    {
      comida: "Hambúrguer",
      preco: 28,
      acompanhamento: "Batata Frita",
      tipo: "Fast Food",
    },
    { comida: "Sushi", preco: 42, tipo: "Oriental" },
    {
      comida: "Lasanha",
      preco: 30,
      acompanhamento: "Salada Verde",
      tipo: "Massa",
    },
    { comida: "Tacos", preco: 25, tipo: "Mexicana" },
    {
      comida: "Churrasco",
      preco: 50,
      acompanhamento: "Farofa",
      tipo: "Brasileira",
    },
    { comida: "Feijoada", preco: 38, tipo: "Brasileira" },
    {
      comida: "Strogonoff",
      preco: 32,
      acompanhamento: "Batata Palha",
      tipo: "Brasileira",
    },
    {
      comida: "Nhoque",
      preco: 27,
      acompanhamento: "Molho de tomate",
      tipo: "Massa",
    },
    { comida: "Yakissoba", preco: 29, tipo: "Oriental" },
  ];

  // Estado do filtro e modo
  const [tiposSelecionados, setTiposSelecionados] = useState([]);
  const [modoMultiplo, setModoMultiplo] = useState(true);

  // Opções únicas de tipo para o MultiSelect
  const opcoesTipo = [...new Set(dados.map((d) => d.tipo))].map((tipo) => ({
    label: tipo,
    value: tipo,
  }));

  // Alternar entre modo único e múltiplo
  const alternarModo = () => {
    const novoModo = !modoMultiplo;
    setModoMultiplo(novoModo);
    if (!novoModo && tiposSelecionados.length > 1) {
      // Se mudar para modo único, mantém apenas o último selecionado
      setTiposSelecionados([tiposSelecionados.at(-1)]);
    }
  };

  // Filtrar os dados com base nos tipos selecionados
  const dadosFiltrados =
    tiposSelecionados.length === 0
      ? dados
      : dados.filter((item) => tiposSelecionados.includes(item.tipo));

  // Gerar todas as colunas dinamicamente
  const colunasDinamicas = [
    ...new Set(dados.flatMap((obj) => Object.keys(obj))),
  ];

  return (
    <div className="card flex flex-column gap-4">
      <h3>Filtro por Tipo:</h3>

      <div className="flex flex-column gap-2 md:w-20rem">
        <Button
          label={`Modo: ${modoMultiplo ? "Múltiplo" : "Único"}`}
          onClick={alternarModo}
        />

        <MultiSelect
          value={tiposSelecionados}
          options={opcoesTipo}
          onChange={(e) => {
            const valor = e.value || [];
            setTiposSelecionados(modoMultiplo ? valor : valor.slice(-1));
          }}
          placeholder="Selecione tipos"
          display="chip"
          filter
          className="w-full"
        />
      </div>

      <DataTable
        value={dadosFiltrados}
        paginator
        rows={5}
        className="w-full"
        responsiveLayout="scroll"
      >
        {colunasDinamicas.map((chave) => (
          <Column
            key={chave}
            field={chave}
            header={chave.charAt(0).toUpperCase() + chave.slice(1)}
          />
        ))}
      </DataTable>
    </div>
  );
};

export default TabelaComidas;
